<!DOCTYPE html>
<html>
<head>
    <title>Student Registration</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }
        form {
            margin-bottom: 30px;
        }
        table {
            border-collapse: collapse;
            width: 70%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        a {
            text-decoration: none;
            color: blue;
        }
    </style>
</head>
<body>

    <h2>Student Registration Form</h2>
    <h2>   {% if error %}
    <p style="color:red">{{ error }}</p>
    {% endif %}
</h2>

    <form action="/register" method="POST">
        Name:
        <input type="text" name="name"  value="{{ student.name if student else '' }}" required><br><br>

        Email:
        <input type="email" name="email" value="{{ student.email if student else '' }}" required><br><br>

        Roll No:
        <input type="text" name="roll" value="{{ student.roll if student else '' }}"  required><br><br>

        <label>Record Audio:</label><br>
        <button type="button" id="recordBtn">Start Recording</button><br><br>
        <audio id="audioPlayback" controls></audio>
        <input type="hidden" name="audio" id="audioInput"><br><br>

        <button type="submit">Register</button>
    </form>

</body>
</html>


<script>
let mediaRecorder;
let audioChunks = [];
const recordBtn = document.getElementById("recordBtn");
const audioPlayback = document.getElementById("audioPlayback");
const audioInput = document.getElementById("audioInput");

recordBtn.addEventListener("click", async () => {
    if (recordBtn.textContent === "Start Recording") {
        // Request microphone access
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = e => {
            audioChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            const audioURL = URL.createObjectURL(audioBlob);
            audioPlayback.src = audioURL;

            // Convert to Base64 to send via hidden input
            const reader = new FileReader();
            reader.readAsDataURL(audioBlob);
            reader.onloadend = () => {
                audioInput.value = reader.result;
            };
        };

        mediaRecorder.start();
        recordBtn.textContent = "Stop Recording";
    } else {
        mediaRecorder.stop();
        recordBtn.textContent = "Start Recording";
    }
});
</script>

